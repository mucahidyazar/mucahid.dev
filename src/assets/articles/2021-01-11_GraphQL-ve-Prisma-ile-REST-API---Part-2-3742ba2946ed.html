<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>GraphQL ve Prisma ile REST API — Part 2</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">GraphQL ve Prisma ile REST API — Part 2</h1>
</header>
<section data-field="subtitle" class="p-summary">
QUERY
</section>
<section data-field="body" class="e-content">
<section name="3ff1" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="8e5a" id="8e5a" class="graf graf--h3 graf--leading graf--title">GraphQL ve Prisma ile REST API – Part 2</h3><p name="622a" id="622a" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">QUERY</strong></p><figure name="6bbf" id="6bbf" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*Om-WMtACMu2kTPBoOviaiQ.jpeg" data-width="1100" data-height="550" src="https://cdn-images-1.medium.com/max/800/1*Om-WMtACMu2kTPBoOviaiQ.jpeg"></figure><p name="ffb8" id="ffb8" class="graf graf--p graf-after--figure">Bir önceki yazımda GraphQL servisimizi ayağa kaldırmıştık. Şimdi de mock datalarımızın olduğu bir db.js oluşturup bu db.js üzerinden GraphQL işlemlerimizi gerçekleştirelim. Bunun için root dizinindeki src klasörüne db.js oluşturup içine aşağıdaki users, posts, ve comments objelerini ekleyip export ediyoruz.</p><figure name="3a21" id="3a21" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/mucahidyazar/9e2c0aafee2e7f0de70257df17a5d1a3.js"></script></figure><p name="98a8" id="98a8" class="graf graf--p graf-after--figure">Yukarıda oluşturduğumuz bu mock datamızı index.js’e import edip daha sonra bunu GraphQLServer’ımıza context olarak tanıtıyoruz aşağıda ki gibi ve bundan sonra bu mock databasemize Query ve Mutationlarımızdan ulaşabileceğiz.</p><figure name="821f" id="821f" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/mucahidyazar/c02ec5180946fbd92d4d4c5825fbfbc2.js"></script><figcaption class="imageCaption">2. satırda import ettiğimiz databasemizi 14. satırda tanımladığımız context içine veriyoruz.</figcaption></figure><p name="f9f4" id="f9f4" class="graf graf--p graf-after--figure">Ve şimdi Bu dataları kullanabilmek için User Post ve Comment için 3 tane type belirleyelim schema.graphql içinde.</p><figure name="6aa3" id="6aa3" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/mucahidyazar/d1a9153681fccceab7bc176fd3b80481.js"></script><figcaption class="imageCaption">Yukarıda User type’ında id, email, username, alanlarını Scalar type olarak belirleyip zorunlu olsun demişiz, age, firstName, lastName ise olabilirde olmayabilirde demişiz. Yani eğer bir user oluşturacak olursak id, email, username vermeden oluşturamayacağımız anlamına geliyor.</figcaption></figure><p name="62be" id="62be" class="graf graf--p graf-after--figure">Şimdi gelin sizlerle ilk gerçek Query mizi oluşturalım. Querylerde REST API’daki GET işlemlerini yapıyoruz diyebiliriz. Yani GraphQL ile sorgulama yaparken Query işlemlerini yapacağız.</p><p name="75d4" id="75d4" class="graf graf--p graf-after--p">Aşağıda ilk olarak tüm postslarımızı çektiğimiz veya eğer argument vererek belirli postslarımızı çekeceğimiz Query tanımlarımızı yapalım.</p><p name="4f8e" id="4f8e" class="graf graf--p graf-after--p">schema.graphql içine aşağıdaki query mizi tanımlayalım.</p><figure name="bf80" id="bf80" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/mucahidyazar/4baedc21d85b0078dc0830870cf0a489.js"></script><figcaption class="imageCaption">Bu Query ile posts querysi için schema.graphql içinde tanımladığımız Post type ında post objelerine sahip bir array return edeceğimizi söylemişiz. Ve bu kesinlikle Array olmalı ve içindeki elemanlarının hepside Post type ında bir obje olmalı diye ! işareti ile belirtmişiz.</figcaption></figure><p name="cd13" id="cd13" class="graf graf--p graf-after--figure">Daha sonra resolver kalsörümüzdeki Query.js dosyasına gelip aşağıda ki gibi context’te gönderdiğimiz db.js mock databasemizden tüm postları return edelim.</p><figure name="1dfb" id="1dfb" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/mucahidyazar/2188f9fc33431740c07393a27570dd1b.js"></script><figcaption class="imageCaption">Ve index.js de GraphQLServer’da context’e eklediğimiz db’ye bu şekilde erişiyoruz.</figcaption></figure><p name="7739" id="7739" class="graf graf--p graf-after--figure">Query, Mutation ve Subscription’larımız function olarak tanımlanır ve içlerinde 4 tane argument taşırlar. Bunlar parent, args, ctx ve info’dur.</p><p name="d1c7" id="d1c7" class="graf graf--p graf-after--p">args’lar Query ve Mutationlar sorgularında gönderdiğimiz argumentleri taşırlar. Örneklerini birazdan göreceğiz.</p><p name="970b" id="970b" class="graf graf--p graf-after--p">ctx ise index.js içinde context objesinin içine tanımladığımız değerleri bize döner.</p><p name="ab9c" id="ab9c" class="graf graf--p graf-after--p">info’da ise dönecek değerler üzerine belirlemeler yaparız.</p><p name="25a4" id="25a4" class="graf graf--p graf-after--p">parent ise bence bu aralarında olan en karışığıdır uygulama üzerinde göstermek istiyorum.</p><p name="ca55" id="ca55" class="graf graf--p graf-after--p">npm run dev yaparak GraphQL serverımızı çalıştırıyoruz ve localhost:3000 veya siz hangi porttan çalıştırıyorsanız orada ki playground’a giderek aşağıdaki gibi query sorgumuzu yaparak tüm posts’larımızı alabiliyoruz artık.</p><figure name="327c" id="327c" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/mucahidyazar/37af4b9344cb7b65ef9bcfd8944f1e31.js"></script></figure><p name="8f91" id="8f91" class="graf graf--p graf-after--figure">Şimdi argsları kullanmayı göreceğiz bunun için şu örneği yapacağız. Tüm postsları yukarıdaki gibi isteyebiliriz şimdi ise tüm post ları belirleyeceğimiz bir query title veya bodyde geçiyorsa filtrelesin ve sadece o query title ve bodyde varsa bize dönsün veya publish edilip edilmediğine göre dönsün filtrelemesini yapsın isteyelim.</p><figure name="c453" id="c453" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/mucahidyazar/aca6ea9e8f95d9720687a26893b55492.js"></script><figcaption class="imageCaption">artık posts querylerini</figcaption></figure><p name="13ed" id="13ed" class="graf graf--p graf-after--figure">Ve daha sonra Query.js e gidip query sorgumuzu aşağıdaki gibi daha karmaşık hale getirelim. :)</p><figure name="40a9" id="40a9" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/mucahidyazar/721e8a8371b4965210d9b43f773df1c5.js"></script><figcaption class="imageCaption">args’lara yukarıdaki gibi ulaşıyoruz. Peki nasıl gönderiyorsunuz diye merak ediyorsanız aşağıdaki Playgrounddan gönderdiğim örneğe bakabilirsiniz. Aşağıdaki gibi gönderdiğim query içindeki argumentlere Query.js içinde yukarıdaki örnekteki gibi ulaşıyorsunuz.</figcaption></figure><figure name="ae77" id="ae77" class="graf graf--figure graf--iframe graf-after--figure graf--trailing"><script src="https://gist.github.com/mucahidyazar/9c2325e30b24bccec19c7fd9f8091746.js"></script><figcaption class="imageCaption">Yukarıda posts’larımızın title ve bodysinde aranması üzere query olarak “post” kelimesini göndermişiz yani title ve bodysinde post kelimesi geçen, published’ı true olan bu her iki özelliği taşıyan tüm postlar sadece return olsun demişiz.</figcaption></figure></div></div></section><section name="ceea" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="bd8d" id="bd8d" class="graf graf--p graf--leading"><strong class="markup--strong markup--p-strong">MUTATIONS</strong></p><p name="4317" id="4317" class="graf graf--p graf-after--p">Mutationlar ise REST API’daki POST methodları olarak düşünebilirsiniz. Birşey oluşturmak silmek veya güncellemek istediğimizde GraphQL’de bunun için Mutationları kullanırız. Gelin ilk mutationumuzu oluşturalım.</p><p name="11a2" id="11a2" class="graf graf--p graf-after--p">Hatırlarsanız User type’ında 3 tane nullable yani zorunlu alan belirlemiştik bunlar id, name ve email idi. Yani eğer bir user oluşturmak istiyorsak bu 3 ünü kesinlikle vermeliyiz.</p><p name="e6c8" id="e6c8" class="graf graf--p graf-after--p">Oluşturacağımzı user’ın bilgilerini mutationumuza argument olarak gönderelim. Hatta gelin bu vesileyle Inputları öğrenelim.</p><p name="2e2c" id="2e2c" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Input</strong></p><p name="dc0e" id="dc0e" class="graf graf--p graf-after--p">Inputlar GraphQL’de başlarında input yazarak tanımlanırlar ve içlerine sadece Scalar type alacak değerler tanımlanır. Yani oluşturduğumuz User Post veya Comment Custom typelarını bunların içerisinde kullanamayız. Zaten bu şekilde kullanmak istiyorsanız Type kullanmalısınız.</p><p name="3098" id="3098" class="graf graf--p graf-after--p">Şimdi createUser’a biz data adında bir argument gönderelim ve bu data argumenti bizim oluşturacağımız adı CreateUserInput olan input’a göre tanımlar içersin istiyoruz. Onun için schema.graphql’e gelip aşağıdaki input’u tanımlıyoruz.</p><figure name="a524" id="a524" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/mucahidyazar/061ac6bfbb47fe63fe44c1effc715a49.js"></script></figure><p name="3d55" id="3d55" class="graf graf--p graf-after--figure">daha sonra schema.graphql içindeki type Mutation içine gelip aşağıdaki gibi createUser mutationunu tanımlıyoruz.</p><figure name="cb5d" id="cb5d" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/mucahidyazar/f51f1091e43303c87a2ff170d34d4f25.js"></script><figcaption class="imageCaption">Burada createUser mutationu içine argument olarak data alsın demişiz ve bu data CreateUserInput özelliklerinde olsun diye belirlemişiz ve son olarakda bize User type ında bir obje dönsün istemişiz.</figcaption></figure><p name="65ac" id="65ac" class="graf graf--p graf-after--figure">Ve şimdi son olarak resolvers daki Mutation.js e gidip createUser mutationunu tanımlamamız gerekiyor.</p><figure name="de02" id="de02" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/mucahidyazar/65d21ca1064393a79710d138e7477a09.js"></script><figcaption class="imageCaption">İlk aşama olarak args’a gönderdiğimiz data içinden user olusturmak için gerekli alanları const olarak alıyoruz yukarıdaki gibi. Daha sonra gelen email bilgisi ile databasemizdeki userlardan hiç bu emaile sahip birisi varmı diye sorgulatıyoruz ve eğer varsa hata fırlatıyoruz çünkü emaillerimiz unique olmalı. Daha sonra newUser değişkeni tanımlayıp uuidv4 kütüphanesi ile random bir id oluşturuyorum ve datadan gelen diğer datalarıda burada kullanıyorum ve bu newUser’ı context’den aldığım db.users içine push ediyorum.</figcaption></figure><p name="efa9" id="efa9" class="graf graf--p graf-after--figure">Ve şimdi GraphQL playgroundumuza giderek aşağıda ki gibi kullanarak bir createUser mutationumuzu kullanabiliriz.</p><figure name="577d" id="577d" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/mucahidyazar/737fed1b7413dbacbac8cc5d3bccdd4f.js"></script></figure><p name="d1c5" id="d1c5" class="graf graf--p graf-after--figure graf--trailing">Ve artık users query’si ile yeni oluşturduğunuz kullanıcı dahil tüm userslarınızı yakalayabilirsiniz.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@mucahidyazar" class="p-author h-card">Mucahid Yazar</a> on <a href="https://medium.com/p/3742ba2946ed"><time class="dt-published" datetime="2021-01-11T21:02:33.325Z">January 11, 2021</time></a>.</p><p><a href="https://medium.com/@mucahidyazar/graphql-ve-prisma-ile-rest-api-part-2-3742ba2946ed" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 24, 2022.</p></footer></article></body></html>