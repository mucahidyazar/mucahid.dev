<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Docker - The core part (Image &amp; Container)</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Docker - The core part (Image &amp; Container)</h1>
</header>
<section data-field="subtitle" class="p-summary">
Docker bizim containerları hazırlamak için kullandığımız tooldur.
</section>
<section data-field="body" class="e-content">
<section name="3089" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="37f3" id="37f3" class="graf graf--h3 graf--leading graf--title">Docker - The core part (Image &amp; Container)</h3><ul class="postList"><li name="57e0" id="57e0" class="graf graf--li graf-after--h3">Docker bizim containerları hazırlamak için kullandığımız tooldur.</li><li name="1e29" id="1e29" class="graf graf--li graf-after--li">Docker kullanmamızın nedenlerinden birisi ise, biz kendi projemizi node.js’in belirli spesifik bir sürümü ile örneğin v13 ile yapıp, herhangi bir node.js uygulaması çalıştıran siteye yüklersek orası belki v12 node.js kullandığı için uygulamamız hata verebilir, fakat docker ile uygulamalarımızı standartlaştırarak containerlar oluşturur ve bu containerları docker destekleyen bir sunucuya(AWS gibi…) yüklersek, uygulamalarımız her zaman bizim belirlediğimiz standartlara göre çalışacaktır.</li></ul><figure name="9636" id="9636" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="0*JXT3zSoRCES-roVv.png" data-width="1400" data-height="700" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/0*JXT3zSoRCES-roVv.png"></figure><h4 name="7edb" id="7edb" class="graf graf--h4 graf-after--figure">Install Docker</h4><ul class="postList"><li name="7776" id="7776" class="graf graf--li graf-after--h4">Önce Hyper-V ve Containers’ı Turn Wiondows feature on/of kısmından aktif ediyoruz.</li><li name="d3fd" id="d3fd" class="graf graf--li graf-after--li">Sonra Dockerın sitesite giderek kullandığımız OS’e göre Dockerın kendisini yüklüyoruz.</li></ul><h4 name="c93a" id="c93a" class="graf graf--h4 graf-after--li">docker … --help</h4><ul class="postList"><li name="e44c" id="e44c" class="graf graf--li graf-after--h4">Başlamadan öcne bilmemiz gereken en önemli şeylerden birisi de, terminalde çalışırken tüm docker komutlarının detaylarını --help yaparak inceleyebiliriz.</li></ul><p name="384c" id="384c" class="graf graf--p graf-after--li">docker images --help<br>docker image --help<br>docker container --help</p><h3 name="47c5" id="47c5" class="graf graf--h3 graf-after--p">IMAGES</h3><h4 name="261a" id="261a" class="graf graf--h4 graf-after--h3">Dockerfile</h4><ul class="postList"><li name="e6ae" id="e6ae" class="graf graf--li graf-after--h4">Her türlü uygulamayı içine sadece <strong class="markup--strong markup--li-strong">Dockerfile</strong> ekleyerek docker ile bir imageye çeviririz.</li></ul><figure name="2c63" id="2c63" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*9MzAYkVjj5y_eAHBWqqGEg.png" data-width="288" data-height="128" src="https://cdn-images-1.medium.com/max/800/1*9MzAYkVjj5y_eAHBWqqGEg.png"></figure><ul class="postList"><li name="d4a8" id="d4a8" class="graf graf--li graf-after--figure">Image uygulamamız için gerekli olan herşeyi içine alır.</li></ul><figure name="4ba5" id="4ba5" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*n32UJqQgigJbaGNaTtd1xg.png" data-width="288" data-height="216" src="https://cdn-images-1.medium.com/max/800/1*n32UJqQgigJbaGNaTtd1xg.png"></figure><ul class="postList"><li name="83ba" id="83ba" class="graf graf--li graf-after--figure">Ve biz bu imageyi dockera vererek containerla çalıştırmasını isteriz.</li><li name="3095" id="3095" class="graf graf--li graf-after--li">Imagemiz hazır olduktan sonra registirye göndeririz. Burası docker hub yani github gibi bir yerdir herkes kullanabilir. Daha sonra registirydeki bu imagemizi buradan herhangi bir docker çalıştıran makinada uygulamamızı çalıştırabiliriz.</li></ul><figure name="b24c" id="b24c" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*wdB2-ue1pojtL6IxcOLfgw.png" data-width="288" data-height="157" src="https://cdn-images-1.medium.com/max/800/1*wdB2-ue1pojtL6IxcOLfgw.png"></figure><ul class="postList"><li name="d72f" id="d72f" class="graf graf--li graf-after--figure">Ve ayrıca imageler aşağıdakileri de içerir.</li></ul><figure name="4146" id="4146" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*X-aLj6enapzLupfonKbqnA.png" data-width="288" data-height="191" src="https://cdn-images-1.medium.com/max/800/1*X-aLj6enapzLupfonKbqnA.png"></figure><h4 name="6f5f" id="6f5f" class="graf graf--h4 graf-after--figure">.dockerignore</h4><ul class="postList"><li name="b6ce" id="b6ce" class="graf graf--li graf-after--h4">Tabi ki de node_modules klasörünü docker imagesine koymak istemeyiz çünkü çok büyük boyutlarda olabilirler bunun içinde .dockerignore dosyası oluşturup içine istemediğimiz dosyaları ve klasörleri yazarız. Aşağıdaki gibi…</li></ul><figure name="f415" id="f415" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/mucahidyazar/6cbf60f84d06a0fea132677312a4a4ba.js"></script></figure><h3 name="1996" id="1996" class="graf graf--h3 graf-after--figure">CONTAINERS</h3><ul class="postList"><li name="4e35" id="4e35" class="graf graf--li graf-after--h3">Containerı ise bir piknik sepeti gibi düşünebilirsiniz. Nasıl piknik yapmak için tek ihtiyacımız olan bir piknik sepeti ise, bir projede ihtiyacımız olan her şey bir container içinde olur.</li></ul><figure name="93ce" id="93ce" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*zdHud-iI8Hk4TpygW9r-OQ.png" data-width="480" data-height="280" src="https://cdn-images-1.medium.com/max/800/1*zdHud-iI8Hk4TpygW9r-OQ.png"></figure><h4 name="66dd" id="66dd" class="graf graf--h4 graf-after--figure">Images vs Containers</h4><ul class="postList"><li name="d7f1" id="d7f1" class="graf graf--li graf-after--h4">Aynı image birden fazla container ile çalışabilir.</li><li name="0a3b" id="0a3b" class="graf graf--li graf-after--li">Imageler kendilerine has environment variableslarına sahip olabilirler.</li><li name="651f" id="651f" class="graf graf--li graf-after--li">Imageler uygulamamızı ve kodlarımızı taşır ve onların blueprintsleridir.</li><li name="8845" id="8845" class="graf graf--li graf-after--li">Imagesler read ve only iken containerlar write, read ve execute accesine sahiptirler.</li><li name="c6d5" id="c6d5" class="graf graf--li graf-after--li">Imagesler bir layerdır, containerlarda aslında onların parent layerlarıdır diyebiliriz.</li><li name="bfcc" id="bfcc" class="graf graf--li graf-after--li">Birbirlerini etkilemeden aynı imageyi farklı bir çok container ile çalıştırabiliriz.</li><li name="8b49" id="8b49" class="graf graf--li graf-after--li">Containerlar, imageler üzerinde yalıtılmış isolated edilmiş bir yazılım birimidir.</li></ul><h3 name="e391" id="e391" class="graf graf--h3 graf-after--li">DOCKER BASIC EXAMPLE</h3><ul class="postList"><li name="4686" id="4686" class="graf graf--li graf-after--h3">Gelin ilk basit uygulamamızı birlikte dockerize edelim.</li><li name="0111" id="0111" class="graf graf--li graf-after--li">Elimizde aşağıda ki gibi app.js dosyası olan ve log basan bir dosyamız var.</li><li name="77b9" id="77b9" class="graf graf--li graf-after--li">İlk olarak Dockerfile adında bir dosya oluşturuyoruz.</li></ul><figure name="64b2" id="64b2" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*UB37V5NVASGHuKAxeao-KQ.png" data-width="480" data-height="173" src="https://cdn-images-1.medium.com/max/800/1*UB37V5NVASGHuKAxeao-KQ.png"></figure><ul class="postList"><li name="03d5" id="03d5" class="graf graf--li graf-after--figure">Daha sonra FROM ile bu imagemizin çalıştıracağı imageyi ayarlıyoruz. app.js’i node.js ile çalıştıracağımız için, node.js’e sahip bir image layerını burada seçmemiz gerekiyor ki Docker bu imageyi alıp bizim çalıştırmasını istediğimiz node.js dosyasını yani app.js’i çalıştırabilsin.</li><li name="ad41" id="ad41" class="graf graf--li graf-after--li">Ve daha sonra distrubitionu seçiyoruz. Alpine bir linux distrubitiondur. Bizim node imagesini direk kullanmak yerine node:alpine kullanmamızın nedeni, boyutu ve performans açısından direkt olarak node.js imagesinden daha performanslı olmasıdır.</li></ul><figure name="cb6d" id="cb6d" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/mucahidyazar/5471f872a41c72d5a305b2049aa13630.js"></script></figure><ul class="postList"><li name="dc7d" id="dc7d" class="graf graf--li graf-after--figure">Aşağıda ki resimde dockerhub’da aratarak bulduğum, aynı zamanda yukarıda da FROM ile kullandığımız <strong class="markup--strong markup--li-strong">node:alpine</strong> gibi bir image görüyorsunuz aslında.</li></ul><figure name="31e3" id="31e3" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*AKvtLFVB-c2g3iZwdHlcpQ.png" data-width="656" data-height="159" src="https://cdn-images-1.medium.com/max/800/1*AKvtLFVB-c2g3iZwdHlcpQ.png"></figure><ul class="postList"><li name="d8f1" id="d8f1" class="graf graf--li graf-after--figure">Daha sonra COPY diyerek <strong class="markup--strong markup--li-strong">“.”</strong> ile tüm dosyalari kopyala yapıyoruz ve <strong class="markup--strong markup--li-strong">“/app”</strong> klasorüne kopyalansın diyoruz.</li><li name="ec07" id="ec07" class="graf graf--li graf-after--li">Ve daha sonra CMD ile komutu çalıştır diyoruz. İlk önce bunu normalde kendi makinamızda çalıştırsaydık node app.js diyeceğimiz için burada da dockerın node ile calıştırmasını söylüyor ve dosyanın yerini veriyoruz. Kopyaladığımız dosyaları <strong class="markup--strong markup--li-strong">app </strong>adında bir klasöre atmıştık hatırlarsanız.</li></ul><figure name="3171" id="3171" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/mucahidyazar/e4534a63a483749f25a7cbe27b2f8918.js"></script></figure><ul class="postList"><li name="e7e1" id="e7e1" class="graf graf--li graf-after--figure">Veya WORKDIR ile bir çalışma yolu belirleyerek daha sonra node app.js de yapabiliriz CMD ile.</li></ul><figure name="bf60" id="bf60" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/mucahidyazar/bd630ab251e814e39884e2ff0129c725.js"></script></figure><ul class="postList"><li name="8496" id="8496" class="graf graf--li graf-after--figure">Ver ilk Dockerfile’mızı oluşturduk. Şimdi imagemizi oluşturup çalıştırabiliriz. Fakat bu detaylara daha sonra geleceğim.</li></ul><h3 name="3016" id="3016" class="graf graf--h3 graf-after--li">Dockerfile</h3><ul class="postList"><li name="785a" id="785a" class="graf graf--li graf-after--h3">Dockerfile içinde aşağıdaki alanlar bulunur. Tüm bu kısımları detaylıca birlikte göreceğiz merak etmeyin.</li></ul><p name="b42d" id="b42d" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">FROM</strong> specify BASE iamge<br><strong class="markup--strong markup--p-strong">WORKDIR </strong>Working directory calisma dizini<br><strong class="markup--strong markup--p-strong">COPY</strong> kopyalamaya yarar<br><strong class="markup--strong markup--p-strong">ADD</strong> kopyalamya yarar<br><strong class="markup--strong markup--p-strong">RUN</strong> execute etmeye yarar kodlari<br><strong class="markup--strong markup--p-strong">ENV </strong>environment variables tanimlariz<br><strong class="markup--strong markup--p-strong">EXPOSE</strong> dockerin imageyi calistiracagi portu ayarlar<br><strong class="markup--strong markup--p-strong">USER</strong> uygulamayi calistiracak useri tanimlar<br><strong class="markup--strong markup--p-strong">CMD </strong>commandin execute edilmesini saglar her acildiginda<br><strong class="markup--strong markup--p-strong">ENTRYPOINT </strong>commandin execute edilmesini saglar her acildiginda</p><figure name="3f2a" id="3f2a" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/mucahidyazar/6ac7a60bb77bfd2bb80036de0eb3af8c.js"></script></figure><h3 name="2a57" id="2a57" class="graf graf--h3 graf-after--figure">EXAMPLE of CREATE-REACT-APP</h3><ul class="postList"><li name="24a9" id="24a9" class="graf graf--li graf-after--h3">Yukarıdaki bilgiler ışığında create-react-app ile daha complex bir uygulama oluşturup bunu dockerıze edebiliriz. Ben <strong class="markup--strong markup--li-strong">create-react-app react-app</strong> yapıyorum.</li></ul><h4 name="f4ee" id="f4ee" class="graf graf--h4 graf-after--li">FROM</h4><ul class="postList"><li name="b81b" id="b81b" class="graf graf--li graf-after--h4">Dockerhub’da bir image buluyoruz FROM da kullanacağımız. Biz react projesini dockerıze edeceğimiz için bir node.js imagesi buluyoruz. Alpine sürümlerinin boyutları az olduğu için onları tercih ediyoruz.</li></ul><figure name="b422" id="b422" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/mucahidyazar/2a42b3089011395a2d3845acc82de36d.js"></script></figure><ul class="postList"><li name="2214" id="2214" class="graf graf--li graf-after--figure">Terminali açıp Dockerfile’mızın olduğu konuma geliyoruz. Ve aşağıdaki kodları uygulayarak neler yaptığını görüyoruz.</li></ul><h4 name="c414" id="c414" class="graf graf--h4 graf-after--li"><strong class="markup--strong markup--h4-strong">docker build .</strong></h4><ul class="postList"><li name="de1c" id="de1c" class="graf graf--li graf-after--h4">Aslında şimdi Dockerfilemızı build alıp image oluşturarak, <strong class="markup--strong markup--li-strong">node:14.16.0-alpine3.13</strong> deki linux terminale bağlanabiliriz.</li><li name="754d" id="754d" class="graf graf--li graf-after--li">Burada ki <strong class="markup--strong markup--li-strong">“.”</strong> ile ise Dockerfile mizin olduğu konumu söyleriz.</li></ul><h4 name="be7d" id="be7d" class="graf graf--h4 graf-after--li"><strong class="markup--strong markup--h4-strong">docker images</strong></h4><ul class="postList"><li name="be3a" id="be3a" class="graf graf--li graf-after--h4">Makinemizde oluşturduğumuz veya çektiğimiz tüm imageleri gösterir. (Intermediate imageler hariç)</li></ul><h4 name="ee02" id="ee02" class="graf graf--h4 graf-after--li"><strong class="markup--strong markup--h4-strong">docker images -a</strong></h4><ul class="postList"><li name="271b" id="271b" class="graf graf--li graf-after--h4">Tüm imageleri gösterir.</li></ul><figure name="5d3d" id="5d3d" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*1vH5_r2FRBn_p6V1xCGSZg.png" data-width="480" data-height="64" src="https://cdn-images-1.medium.com/max/800/1*1vH5_r2FRBn_p6V1xCGSZg.png"></figure><h4 name="2d14" id="2d14" class="graf graf--h4 graf-after--figure">docker image ls</h4><ul class="postList"><li name="19ea" id="19ea" class="graf graf--li graf-after--h4">Tüm imageleri listeler. docker images ile aynı işlevi gerçekleştirir bir nevi.</li></ul><h4 name="e28b" id="e28b" class="graf graf--h4 graf-after--li">docker image prune</h4><ul class="postList"><li name="7e7f" id="7e7f" class="graf graf--li graf-after--h4">Kullanılmayan imageleri siler.</li><li name="c5a5" id="c5a5" class="graf graf--li graf-after--li">Kullanilmayan imageleri sildikten sonra imageleri listelersek sadece kendi olusturdugumuz ve pull yaptigimiz imageleri goruruz.</li></ul><figure name="9953" id="9953" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*XZURxiHLkr3ZRwTfNuK5qA.png" data-width="480" data-height="163" src="https://cdn-images-1.medium.com/max/800/1*XZURxiHLkr3ZRwTfNuK5qA.png"></figure><h4 name="f783" id="f783" class="graf graf--h4 graf-after--figure">docker image prune -a</h4><ul class="postList"><li name="d263" id="d263" class="graf graf--li graf-after--h4">Kullanılsın kullanımlasın tüm imageleri siler.</li></ul><h4 name="d7f6" id="d7f6" class="graf graf--h4 graf-after--li">docker rmi imageName:tag/imageId<br>docker image rm imageName:tag/imageId</h4><ul class="postList"><li name="8742" id="8742" class="graf graf--li graf-after--h4">Prune ile silinmeyen yukarıda ki gibi imageleri silmek içinse asağıda ki gibi docker image dedikten sonra remove anlamına gelen rm ve image adınıveya idsini yazariz.<br><em class="markup--em markup--li-em">docker image rm react-app<br>docker image rm df3</em></li></ul><h4 name="fc12" id="fc12" class="graf graf--h4 graf-after--li"><strong class="markup--strong markup--h4-strong">docker ps</strong></h4><ul class="postList"><li name="8724" id="8724" class="graf graf--li graf-after--h4">Çalışan bütün containerları gösterir.</li></ul><h4 name="8073" id="8073" class="graf graf--h4 graf-after--li"><strong class="markup--strong markup--h4-strong">docker ps -a</strong></h4><ul class="postList"><li name="c743" id="c743" class="graf graf--li graf-after--h4">Bütün containerları gösterir.</li></ul><h4 name="0e7f" id="0e7f" class="graf graf--h4 graf-after--li">docker container ls</h4><ul class="postList"><li name="d832" id="d832" class="graf graf--li graf-after--h4">Tüm containerları listeler. docker ps -a ile aynı işlevi gerçekleştirir bir nevi.</li></ul><h4 name="29fc" id="29fc" class="graf graf--h4 graf-after--li">docker container prune</h4><ul class="postList"><li name="9e74" id="9e74" class="graf graf--li graf-after--h4">Kullanılmayan containerları siler.</li></ul><h4 name="e9af" id="e9af" class="graf graf--h4 graf-after--li">docker rm containerName/containerId<br>docker container rm containerName/containerId</h4><ul class="postList"><li name="a736" id="a736" class="graf graf--li graf-after--h4">prune ile silinmeyen containerları silmek içinse asağıda ki gibi docker container dedikten sonra remove anlamina gelen rm ve container adını veya idsini yazarız.<br><em class="markup--em markup--li-em">docker container rm react-app<br>docker container rm df3</em></li></ul><h4 name="7d19" id="7d19" class="graf graf--h4 graf-after--li">docker rm -f containerName/containerId<br>docker container -f rm containerName/containerId</h4><ul class="postList"><li name="678c" id="678c" class="graf graf--li graf-after--h4">Çalışan containerları force yaparak önce durdurur sonra siler. Yukarıda ki kodla çalışan containerları silemeyiz.</li></ul><h4 name="bd79" id="bd79" class="graf graf--h4 graf-after--li">docker stop containerId</h4><ul class="postList"><li name="6e8c" id="6e8c" class="graf graf--li graf-after--h4">Bu şekilde de belirli bir container id ye sahip containerin çalışmasını durdururuz.</li></ul><h4 name="ef82" id="ef82" class="graf graf--h4 graf-after--li">docker start -i containerId</h4><ul class="postList"><li name="e67e" id="e67e" class="graf graf--li graf-after--h4">Bu şekilde de belirli bir container id ye sahip containerı çalıştırırız. Id’nin ilk 3 karakteri de yeterli olur. Veya id yerine containerName de yazabilirsiniz.</li><li name="90aa" id="90aa" class="graf graf--li graf-after--li">-i terminal ile interact olmasını sağlar yani terminale bağlnamasını sağlar.</li></ul><h4 name="d77d" id="d77d" class="graf graf--h4 graf-after--li">exit</h4><ul class="postList"><li name="aa7b" id="aa7b" class="graf graf--li graf-after--h4">-it ile interactive bir şekilde başlattığımız containerlar Docker container sessionunu kapatır ve terminalden çıkar. Fakat containerı tamamen silmez bunu bizim yapmamız gerekiyor.</li></ul><figure name="8382" id="8382" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*RJZMxYXJOM3C99EpmommQQ.png" data-width="479" data-height="49" src="https://cdn-images-1.medium.com/max/800/1*RJZMxYXJOM3C99EpmommQQ.png"></figure><h3 name="ff12" id="ff12" class="graf graf--h3 graf-after--figure">Naming/Tagging Images</h3><ul class="postList"><li name="2a92" id="2a92" class="graf graf--li graf-after--h3">Developmentda tagsiz kullanmakta sorun yok ama productionda tagging kesinlikle yapmalıyız. Çünkü ileride yeni tagli versiyonda bir sorun çıkarsa eski tagi bilerek tekrar hemen dönebiliriz.</li></ul><h4 name="7245" id="7245" class="graf graf--h4 graf-after--li">docker build -t imageName .</h4><ul class="postList"><li name="d78a" id="d78a" class="graf graf--li graf-after--h4">Imageleri listelediğimizde eğer imagelere sadece imageName verdiysek latest tagını görürüz default olarak.</li></ul><figure name="cb62" id="cb62" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*3sWhJ5YCII-qsSkL6pXhQg.png" data-width="480" data-height="206" src="https://cdn-images-1.medium.com/max/800/1*3sWhJ5YCII-qsSkL6pXhQg.png"></figure><h4 name="239e" id="239e" class="graf graf--h4 graf-after--figure">docker build -t imageName:tag .</h4><ul class="postList"><li name="9388" id="9388" class="graf graf--li graf-after--h4">Oluşturacağımız imagelere -t ile tag ekleyerek isimlendirebiliriz.</li></ul><h4 name="e296" id="e296" class="graf graf--h4 graf-after--li">docker build -t react-app:v0.0.01 .</h4><ul class="postList"><li name="fefa" id="fefa" class="graf graf--li graf-after--h4">Yukarıda oluşturacağımız image için react-app isimlendirmesi yaptık ve tag olarakda <strong class="markup--strong markup--li-strong">v0.0.01</strong> olsun dedik.</li></ul><figure name="4915" id="4915" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*clxWvbzv5KYLgmCeia34YA.png" data-width="480" data-height="176" src="https://cdn-images-1.medium.com/max/800/1*clxWvbzv5KYLgmCeia34YA.png"></figure><ul class="postList"><li name="23fb" id="23fb" class="graf graf--li graf-after--figure">Genel olarak latest tagini her zaman en son versiona sahip olan image olarak tutmalıyız. Ve latest tagindeki imageyi docker ile çalıştırtmalıyız.</li><li name="e5f5" id="e5f5" class="graf graf--li graf-after--li">Tagleri hem dockerfile da yada hemde run timeda asagidaki gibi yazabiliriz.</li><li name="0908" id="0908" class="graf graf--li graf-after--li">Tag verirken bir kac cesit tag verme turu vardir.<br>Versiyon numarası ile: docker build react-app:<strong class="markup--strong markup--li-strong">v0.0.01</strong> .<br>Sıralamalı : docker build react-app:<strong class="markup--strong markup--li-strong">0</strong> .</li></ul><h4 name="5d74" id="5d74" class="graf graf--h4 graf-after--li">tag</h4><p name="a310" id="a310" class="graf graf--p graf-after--h4"><strong class="markup--strong markup--p-strong">docker image tag imageId/imageName:tag imageId/imageName:tag</strong></p><ul class="postList"><li name="3b23" id="3b23" class="graf graf--li graf-after--p">Bu kodla varolan bir imageyi kopyalayarak yeniden yeni bir isim ve tagle yeni bir image oluşturabiliriz. Veya varolan bir imageyi seçerek, başka bir varolan imagenin bu imageye dönüşmesini sağlayabiliriz. Örneğin yukarıdaki kodda ilk imageId ile seçtiğimiz image bizim için bir referans, daha sorna sında seçtiğimiz ise yeni oluşturtmak istediğimiz image olacak. Veya ikinci seçtiğimiz image adında bir image zaten varsa onu alıp bizim ilk seçtiğimiz imageye çevirtiriz.</li><li name="ec6e" id="ec6e" class="graf graf--li graf-after--li">tagi kullanmadan önce aşağıda ilk olarak Dockerfile’a WORKDIR /app adında bir satır daha ekleyerek bir değişiklik yapıyorum.</li></ul><figure name="1128" id="1128" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/mucahidyazar/672126fedfea560d76ef670f16f51bc8.js"></script></figure><ul class="postList"><li name="06f4" id="06f4" class="graf graf--li graf-after--figure">Sonra build alarak v0.0.02 tagli yeni imagemi oluşturuyorum.</li></ul><figure name="a132" id="a132" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*sD8DocuiAxGUyxaTN7ez9g.png" data-width="480" data-height="221" src="https://cdn-images-1.medium.com/max/800/1*sD8DocuiAxGUyxaTN7ez9g.png"></figure><ul class="postList"><li name="09d0" id="09d0" class="graf graf--li graf-after--figure">Yukarıda göreceğiniz üzere yeni son version imagemin idsi latest versiondan farklı. Bunu düzeltmemiz gerekiyor.</li></ul><p name="d41a" id="d41a" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">docker image tag 5af react-app:latest</strong></p><ul class="postList"><li name="9bdf" id="9bdf" class="graf graf--li graf-after--p">Ve aşağıda 5af id si ile başlayan imageyi seçiyoruz ve artık react-app:latest adında bir image yoksa bunu oluşturmasını veya varsa da bu imagenin artık 5af id li image ile aynısı olmasını istiyoruz.</li></ul><figure name="afe6" id="afe6" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*YRRtMWMQy5w5iSbKQYMPFg.png" data-width="480" data-height="85" src="https://cdn-images-1.medium.com/max/800/1*YRRtMWMQy5w5iSbKQYMPFg.png"></figure><p name="1e97" id="1e97" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">docker image tag 5af react-app:v0.0.03</strong></p><ul class="postList"><li name="556d" id="556d" class="graf graf--li graf-after--p">Veya hiç olmayan bir image adı ve tagiyle yeni bir image kopyası oluşturabilirdik. tabi ben daha sonra bu v0.0.03&#39;ü aşağıda ki kod ile kaldırıyorum.<br>docker image rm react-app:v0.0.03</li></ul><figure name="f3ee" id="f3ee" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*K0OfmNAwOHb_PdktsOjpKQ.png" data-width="480" data-height="90" src="https://cdn-images-1.medium.com/max/800/1*K0OfmNAwOHb_PdktsOjpKQ.png"></figure><h3 name="5ba0" id="5ba0" class="graf graf--h3 graf-after--figure">docker run</h3><h4 name="dd1c" id="dd1c" class="graf graf--h4 graf-after--h3">docker run imageId/imageName</h4><ul class="postList"><li name="e431" id="e431" class="graf graf--li graf-after--h4">Bu kodla oluşturduğumuz imageleri çalıştırabiliriz.</li></ul><h4 name="3c80" id="3c80" class="graf graf--h4 graf-after--li">docker run react-app<br>docker run react-app:v0.0.01<br>docker run react-app:latest<br>docker run 34870cf3b371<br>docker run 348</h4><ul class="postList"><li name="37ed" id="37ed" class="graf graf--li graf-after--h4">Yukarıda bir imageyi genel olarak çalıştırabileceğiniz bir birinden farklı şekilde yöntemleri gösterdim. ister image adıyla, ister image adı ve versiyon numarası ile, ister id ile istersenizde idnizin 3 karakteri ile imagelerimizi çalıştırabiliriz.</li></ul><p name="5314" id="5314" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">docker run node</em></strong></p><ul class="postList"><li name="0f0b" id="0f0b" class="graf graf--li graf-after--p">Bu şekilde çalıştırırsak <em class="markup--em markup--li-em">dockerhub </em>dan node imagesinin son güncel imagesini alıp, makinemize kurup, arka planda bir container oluşturup, node imagesini çalıştıracaktır.</li></ul><h4 name="c51a" id="c51a" class="graf graf--h4 graf-after--li">docker run -it imageId/imageName</h4><ul class="postList"><li name="16f5" id="16f5" class="graf graf--li graf-after--h4">-it ile interactive diyerekde imagelerimizi çalıştırarak ardından terminale bağlanabiliriz.</li></ul><h4 name="5bea" id="5bea" class="graf graf--h4 graf-after--li"><strong class="markup--strong markup--h4-strong"><em class="markup--em markup--h4-em">docker run -it node</em></strong></h4><ul class="postList"><li name="3aa0" id="3aa0" class="graf graf--li graf-after--h4">Bu şekilde yaparsak -it ile interactive diyeceğimiz için docker node’un son imagesini indirip yeni bir container oluşturup, bu imageyi kullanarak node imagesini interactive olarak çalıştıracak ve terminale bağlanacaktır. Asagidaki gibi.</li><li name="dfb3" id="dfb3" class="graf graf--li graf-after--li">Ve aşağıda göreceğiniz üzere node imagesini run yapip -it ile terminale bağlandığım zaman nodeun versionu 15.4.0, benim kendi makinemdeki ise 14.15.4. Yani burda çalışan container aslında bir sanal makine.</li></ul><figure name="4267" id="4267" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*locy2qoV7DhWlOAEcfSizg.png" data-width="480" data-height="247" src="https://cdn-images-1.medium.com/max/800/1*locy2qoV7DhWlOAEcfSizg.png"></figure><h4 name="6222" id="6222" class="graf graf--h4 graf-after--figure"><strong class="markup--strong markup--h4-strong">NAMING CONTAINERS<br>docker run -d --name fakeName imageId</strong></h4><ul class="postList"><li name="c92c" id="c92c" class="graf graf--li graf-after--h4">Aynı containerı farklı bir isim ile çalıştırmak böylelikle aynı containerı aynı anda 2 kere çalıştırabiliyor olacağız.</li></ul><figure name="8a2d" id="8a2d" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*O1UYfpxcBvVgIQPKCcLO5Q.png" data-width="480" data-height="60" src="https://cdn-images-1.medium.com/max/800/1*O1UYfpxcBvVgIQPKCcLO5Q.png"></figure><ul class="postList"><li name="0677" id="0677" class="graf graf--li graf-after--figure">Ve şimdi 2 containerımız var bunlardan birisi blue-sky</li></ul><figure name="bb2e" id="bb2e" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*grV8WBxTSgMgauT5zNnlQQ.png" data-width="480" data-height="97" src="https://cdn-images-1.medium.com/max/800/1*grV8WBxTSgMgauT5zNnlQQ.png"></figure><h4 name="1bb4" id="1bb4" class="graf graf--h4 graf-after--figure">docker run --rm imageName</h4><p name="5479" id="5479" class="graf graf--p graf-after--h4">· İmagenin çalıştırıldığı container durdurulduğunda, containerın otomatik olarak silinmesini sağlar.</p><h4 name="4ec4" id="4ec4" class="graf graf--h4 graf-after--p"><strong class="markup--strong markup--h4-strong">docker build -it react-app .</strong></h4><ul class="postList"><li name="ed89" id="ed89" class="graf graf--li graf-after--h4">Ve şimdi eğer aşağıda ki gibi docker run yapip -it yani interactive şeklinde oluşturduğumuz imagemizi çalıştırırsak sanal docker makinasında çalışan bir node terminalini çalıştırmış olacağız çünkü “FROM”a “node”u vermiştik hatırlıyorsanız.</li></ul><figure name="4a4d" id="4a4d" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*QXLeWzudH7ivjnt1wzmK4g.png" data-width="288" data-height="160" src="https://cdn-images-1.medium.com/max/800/1*QXLeWzudH7ivjnt1wzmK4g.png"></figure><ul class="postList"><li name="bac7" id="bac7" class="graf graf--li graf-after--figure">Eğer bu şekilde başlatmayı denersekte hata alırız çünkü alpine linux imagesi bash ile birlikte gelmez, shell ile gelir. O yüzden boyutu azdır.</li></ul><figure name="afe7" id="afe7" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*9_cb7HDN35WewxTnpoENkg.png" data-width="480" data-height="54" src="https://cdn-images-1.medium.com/max/800/1*9_cb7HDN35WewxTnpoENkg.png"></figure><ul class="postList"><li name="7872" id="7872" class="graf graf--li graf-after--figure">Fakat sh ile shelli çalıştırsaydık hem linux dosya sistemini görebilirdik hem de node versiyonumuzu görebilirdik çalışan docker makinamızda.</li></ul><figure name="b134" id="b134" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*ifTMOV6osXi4Yis0J0nBVQ.png" data-width="480" data-height="140" src="https://cdn-images-1.medium.com/max/800/1*ifTMOV6osXi4Yis0J0nBVQ.png"></figure><h4 name="578f" id="578f" class="graf graf--h4 graf-after--figure">COPY / ADD - WORKDIR</h4><ul class="postList"><li name="9d38" id="9d38" class="graf graf--li graf-after--h4">Şimdi uygulama dosyalarımızı imageye kopyalamamız gerekiyor.</li><li name="28c0" id="28c0" class="graf graf--li graf-after--li">WORKDIR ile çalışma dizinini /app yapıyoruz. Bu şekilde containerımızı çalıştırdığımızda /app dizininde uygulamamız ayarlanıp başlatılacak.</li><li name="d86a" id="d86a" class="graf graf--li graf-after--li">COPY ile tüm package ile başlayan dosyalar ve README.md dosyasını /app/ klasörüne kopyalıyoruz.</li><li name="fc5f" id="fc5f" class="graf graf--li graf-after--li">Veya dilersek 2. COPY deki gibi . ile tüm dosyaları seçerek /app/ klasörüne kopyalayabiliriz.</li><li name="3811" id="3811" class="graf graf--li graf-after--li">Veya . ile tüm dosyaları seçerek ikinci nokta ile de olduğumuz klasçre yani /app/’e kopyalayabiliriz. Buradaki 2. COPY deki birinci . bizim Dockerfilenin bulunduğu dizini, ikinci . ise imagenin WORKDIR’ini temsil eder yani /app/ dizinini.</li></ul><figure name="8af0" id="8af0" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*JodsZ68wYWwmVMWa9pSu0w.png" data-width="480" data-height="78" src="https://cdn-images-1.medium.com/max/800/1*JodsZ68wYWwmVMWa9pSu0w.png"></figure><ul class="postList"><li name="7598" id="7598" class="graf graf--li graf-after--figure">ADD ile ise bir link ekleyebiliriz veya file.zip gibi sıkıştırılmış dosyalariı açarak istediğimiz yere çıkartabiliriz.</li></ul><figure name="9ca0" id="9ca0" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/mucahidyazar/5a5b93766aada7f4f57d915a9fe2fd3b.js"></script></figure><h4 name="d4b5" id="d4b5" class="graf graf--h4 graf-after--figure">RUN</h4><ul class="postList"><li name="8068" id="8068" class="graf graf--li graf-after--h4">Dockerı yukarida ki haliyle çalıştırdığımızda dependenciesler yüklü olmadığı için sorun olacaktır. O yüzden dependenciesleri imagemizi çalıştırdıktan sonra yükletmeliyiz aşağıda ki gibi.</li><li name="1007" id="1007" class="graf graf--li graf-after--li">Aşağıdaki gibi RUN komutuyla npm komutumuzu çalıştırarak gerekli dependenciesleri yükleyebiliriz.</li></ul><figure name="e6dd" id="e6dd" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/mucahidyazar/24ef128b49f27566a9f6f9f09ede918c.js"></script></figure><ul class="postList"><li name="bf5d" id="bf5d" class="graf graf--li graf-after--figure">Aşağıdaki gibi 2 tane komut da çalıştırabiliriz fakat apt komutu FORM daki imagemizden gelen alpine surumu linuxde olmadığı için hata alırız.</li></ul><figure name="07c3" id="07c3" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/mucahidyazar/1bbdceeb269097253884da71d353c643.js"></script></figure><h4 name="1ecf" id="1ecf" class="graf graf--h4 graf-after--figure">ENV</h4><ul class="postList"><li name="c085" id="c085" class="graf graf--li graf-after--h4">Environment variableları ise aşağıda ki gibi ya aralarında bir boşluk bırakarak yada = ile tanımlayabiliriz ben = ile tanımlamayı tercih ediyorum.</li></ul><figure name="4eab" id="4eab" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/mucahidyazar/9d2aa46493d4641e1dffec3a83cb7911.js"></script></figure><ul class="postList"><li name="0e95" id="0e95" class="graf graf--li graf-after--figure">Ve daha sorna imagemizi oluşturup containerimızı shellde interactive olarak imagemizi çalıştırdığımız da istersek bu environmentlerı aşağıda ki gibi görebiliriz..</li></ul><figure name="490e" id="490e" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*RzTwqJbwDXTqm2iywI8_IA.png" data-width="480" data-height="187" src="https://cdn-images-1.medium.com/max/800/1*RzTwqJbwDXTqm2iywI8_IA.png"></figure><ul class="postList"><li name="c882" id="c882" class="graf graf--li graf-after--figure">Veya shell ile çalıştırdığımız için istersek yazdırabiliriz de echo yaparak.</li></ul><figure name="6be0" id="6be0" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*UhdCNM6LQc_Nv0r4iJY8Uw.png" data-width="288" data-height="151" src="https://cdn-images-1.medium.com/max/800/1*UhdCNM6LQc_Nv0r4iJY8Uw.png"></figure><h4 name="6dda" id="6dda" class="graf graf--h4 graf-after--figure">EXPOSE</h4><ul class="postList"><li name="82fb" id="82fb" class="graf graf--li graf-after--h4">Expose ile port exposing işlemlerimizi yapabiliriz. Dockerda port atadığımızda çalışan port containerda çalışır host üzerinde çalışmaz bunu anlamamız gerekir.</li></ul><figure name="a81b" id="a81b" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/mucahidyazar/76ea357668f2d404624fe3f22cb653af.js"></script></figure><ul class="postList"><li name="6704" id="6704" class="graf graf--li graf-after--figure">En son oluşturduğumuz Dockerfile bir üstteki Dockerfile’dır. Gelin bunu build alalım ve <strong class="markup--strong markup--li-strong">npm start</strong> ile birlikte çalıştıralım ve react-app uygulamamızı çalıştırıp, -it ilede interactive olarak bağlanarak uygulamamızın çalıştığından emin olalım.</li></ul><h4 name="a092" id="a092" class="graf graf--h4 graf-after--li">docker run react:app:latest npm start</h4><figure name="8236" id="8236" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="1*uqoXu4_XDBaexmKf7RDVyw.png" data-width="480" data-height="139" src="https://cdn-images-1.medium.com/max/800/1*uqoXu4_XDBaexmKf7RDVyw.png"></figure><ul class="postList"><li name="4409" id="4409" class="graf graf--li graf-after--figure">Direk npm start komutunu yukarıda ki gibi yazarak run time terminal kodlarımızı burada da çalıştırarak react-app uygulamamızı sanal makinamız üzerinde çalıştırabiliriz.</li></ul><figure name="4aff" id="4aff" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*H_lyDQN_6h5T7Nh7I59KAw.png" data-width="480" data-height="284" src="https://cdn-images-1.medium.com/max/800/1*H_lyDQN_6h5T7Nh7I59KAw.png"><figcaption class="imageCaption">Burada çalışan localhost:3000 kullandığınız sistemdeki 3000 değildir. Bu containerın ait olduğu sanal sistem üzerinde uygulamamızın çalıştığı porttur. Bu portu daha sorna göstereceğim işlemlerle kendi işletim sistemimizdeki porta bind etmeyi öğreneceğiz.</figcaption></figure><h4 name="0e2a" id="0e2a" class="graf graf--h4 graf-after--figure"><strong class="markup--strong markup--h4-strong">CMD</strong></h4><ul class="postList"><li name="7e91" id="7e91" class="graf graf--li graf-after--h4">Sürekli yukarıda ki gibi containerı başlatırken npm start yapmak güzel değildir. İşte bunun için docker bunun yerine bize CMD keyini vermiş bu komutlarımızı burada aşağıda ki gibi Dockerfile içinde tanımlayabiliriz.</li><li name="9ada" id="9ada" class="graf graf--li graf-after--li">CMD kodunu sadece bir kere yazabiliriz 2. Bir CMD komutu olursa hangisi en sonda olursa o sadece çalışır.</li></ul><figure name="cab0" id="cab0" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/mucahidyazar/d3fbfca6e738ef0e4a36e20f722fb269.js"></script></figure><ul class="postList"><li name="7512" id="7512" class="graf graf--li graf-after--figure">CMD’leri 2 şekilde tanımlayabiliriz.</li><li name="b487" id="b487" class="graf graf--li graf-after--li">Shell form şeklinde yukarıda ki gibi,</li><li name="6cbf" id="6cbf" class="graf graf--li graf-after--li">Execute form şeklinde array içinde string gibi<br>(Benim tavsiyem her zaman execute form yapısında olanı kullanmanızdır.)</li></ul><figure name="f283" id="f283" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*HwQm6pvg8uOxto-DdFAWlg.png" data-width="147" data-height="127" src="https://cdn-images-1.medium.com/max/800/1*HwQm6pvg8uOxto-DdFAWlg.png"></figure><p name="3a62" id="3a62" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">CMD vs RUN</strong></p><ul class="postList"><li name="30e1" id="30e1" class="graf graf--li graf-after--p">RUN build-time talimatıdır yani build-time da çalışır.</li><li name="3180" id="3180" class="graf graf--li graf-after--li">CMD ise run-time talimatıdır yani containerımızı çalıştırırken çalışır.</li></ul><h4 name="8cdd" id="8cdd" class="graf graf--h4 graf-after--li">ENTRYPOINT</h4><ul class="postList"><li name="2b43" id="2b43" class="graf graf--li graf-after--h4">CMD ile yaptıkları işlemde, kullanımları da aslında bire bir aynıdır. Yine 2 şekilde tanımlanır. Yani shell form veya execute form şeklinde.</li></ul><figure name="c84a" id="c84a" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/mucahidyazar/9597c79d9a6a7ff3d70107493b042ad3.js"></script></figure><p name="5159" id="5159" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">ENTRYPOINT vs CMD</strong></p><ul class="postList"><li name="8b38" id="8b38" class="graf graf--li graf-after--p">Eğer CMD tanımladıktan sonra aşağıda ki gibi containerı çalıştırırken farklı bir command eklersek bu komut, Dockerfile içindeki CMD deki komutu ezer fakat ENTRYPOINT deki komutu ezemez.</li></ul><figure name="d526" id="d526" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*xE7VrAOqhjN4gt5fL13EPw.png" data-width="480" data-height="59" src="https://cdn-images-1.medium.com/max/800/1*xE7VrAOqhjN4gt5fL13EPw.png"></figure><ul class="postList"><li name="7701" id="7701" class="graf graf--li graf-after--figure">Veya illa da ezdireceksek aşağıda ki gibi --entrypoint şeklinde tanımlamamız gerekiyor.</li></ul><figure name="c460" id="c460" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*HGHa6XJOLLjgvB9cI8BsBg.png" data-width="480" data-height="59" src="https://cdn-images-1.medium.com/max/800/1*HGHa6XJOLLjgvB9cI8BsBg.png"></figure><figure name="2db3" id="2db3" class="graf graf--figure graf--iframe graf-after--figure"><script src="https://gist.github.com/mucahidyazar/9597c79d9a6a7ff3d70107493b042ad3.js"></script></figure><h4 name="e37d" id="e37d" class="graf graf--h4 graf-after--figure">LAYERS</h4><ul class="postList"><li name="6840" id="6840" class="graf graf--li graf-after--h4">Yukarıda ki en son bıraktığımız Dockerfilemıza bakarak, Layerlar Dockerfile ile oluşturacağımız imageler içerisinde ki katmanlardır. Docker ilk başta node imagesini alır ve bir layera koyar. Node imagesi ise kendi içinde bir kaç layerdır. Kalan kodlarda ki her bir satırda aslında farklı bir kaç layer oluşturur.</li></ul><h4 name="177f" id="177f" class="graf graf--h4 graf-after--li">docker history imageId/imageName</h4><ul class="postList"><li name="1377" id="1377" class="graf graf--li graf-after--h4">Layerları görmek için aşağıda ki kodu yazıyoruz. Ve burada gmrdüğünüz her satır bir layerdır aslında.</li></ul><figure name="9223" id="9223" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*rUAkGQAtPym-bJOQRZq7Bw.png" data-width="480" data-height="177" src="https://cdn-images-1.medium.com/max/800/1*rUAkGQAtPym-bJOQRZq7Bw.png"></figure><h4 name="4634" id="4634" class="graf graf--h4 graf-after--figure">CACHING</h4><ul class="postList"><li name="780c" id="780c" class="graf graf--li graf-after--h4">Image oluşturulurken ilk başta cache verisi olmadığı için kullanılamaz. Fakat ne zaman dosyalarımızda bir değişiklik olursa ve tekrar build alırsak o zaman bazı layerlar cacheden alınır bazıları ise yeniden oluşturulur. Docker bunu yaparken değişiklik olan kısıma kadar olan tüm heryeri cachelediği veriden alır, kalan kısımları tekrar hesaplayarak yeni build oluşturur.</li><li name="ba35" id="ba35" class="graf graf--li graf-after--li">Caching yapısını daha iyi görebilmek için ilk önce tüm imagelerimizi siliyoruz. Eğer çalışan bir container varsa imageyi silemeyiz o yüzden önce tüm containerları siliyoruz daha sonra tüm imageleri siliyoruz.</li><li name="9e8f" id="9e8f" class="graf graf--li graf-after--li">Ve en son Dockerfilemızı hatırlıyoruz aşağıda ki gibiydi.</li></ul><figure name="eae8" id="eae8" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/mucahidyazar/9597c79d9a6a7ff3d70107493b042ad3.js"></script></figure><ul class="postList"><li name="e9bd" id="e9bd" class="graf graf--li graf-after--figure">Şimdi ilk image buildini alıyoruz. Gördüğünüz gibi bazı layerları şimdi ilk defa cacheliyorum zaten başındada CACHED diye yazıyor bunlar. Ve zamanıda görüyorsunuz npm install yapmak 79 saniyemizi almış. Hiç istemeyeceğimiz bir şey.</li></ul><figure name="7223" id="7223" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*WT6xfHQNPh957KjY4Ebc8w.png" data-width="480" data-height="203" src="https://cdn-images-1.medium.com/max/800/1*WT6xfHQNPh957KjY4Ebc8w.png"></figure><ul class="postList"><li name="57b7" id="57b7" class="graf graf--li graf-after--figure">Hiçbir değişiklik yapmadan gelin şimdi v0.0.01 adında yeni bir tag ile yeni bir build alalım. Aşağıda göreceğiniz üzere 1.5 saniye almış en uzun işlem çünkü npm installı tekrar yapmadı ve CACHED olmuş veriyi kullandı hiçbir değişiklik olmadığı için.</li></ul><figure name="950c" id="950c" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*jLrM-UjQuBlloMkvYrXcDw.png" data-width="480" data-height="207" src="https://cdn-images-1.medium.com/max/800/1*jLrM-UjQuBlloMkvYrXcDw.png"></figure><ul class="postList"><li name="f6fb" id="f6fb" class="graf graf--li graf-after--figure">Daha iyi farkı görmek adına bir tane ünlem işareti ekleyip bir değişiklik yapalım react-app uygulamamız içindeki App.js içine ve sonra gelin v0.0.02 buildinin ne kadar süreceğini gözlemleyelim. Gördüğünüz gibi yine 76 saniye npm install yapıyor. Dosyamızdaki bir karakter değişikliğinden ötürü.</li></ul><figure name="bdaf" id="bdaf" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*9osLzbiBcVlOJpPQqLGjIw.png" data-width="480" data-height="191" src="https://cdn-images-1.medium.com/max/800/1*9osLzbiBcVlOJpPQqLGjIw.png"></figure><ul class="postList"><li name="8f4a" id="8f4a" class="graf graf--li graf-after--figure">Yukarıdaki gibi durumlar için biz ne kadar değişiklik yaparsak yapalım, aşağıdaki gibi kendi yöntemlerimizi geliştirerek bu gibi uzun süren işlemleri her defasından cacheden kullanarak önlememiz gerekmektedir.</li></ul><figure name="d617" id="d617" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/mucahidyazar/b5823b8b6742a95335b0f0f45ef44853.js"></script></figure><ul class="postList"><li name="ed2a" id="ed2a" class="graf graf--li graf-after--figure">Bu durumda biz Dockerfile içinde package.jsonumuzu ilk önce /app dizinine kopyalıyorum ve daha sonra npm install işlemini yapıyorum. Ve bu yüzden docker diğer dosyaları daha almadığı için değişiklik olup olmadığını bilmeyecek ve 3. ve 4. satırdaki COPY ve RUN işlemlerini her defasında cachelediği veriden kullanacak. Tabi package.json içinde bir değişiklik olmazsa.</li><li name="851a" id="851a" class="graf graf--li graf-after--li">Ve şimdi tekrar tüm containerslarımızı ve imagelerimizi silip temizledikten sonra yeniden bir temiz bir build alıyoruz. Terminaldeki ilk buildi görüyorsunuz 92 saniye sürmüş. Daha sonra App.js içine gidip “t” adında ekstra bir karakter daha ekliyorum ve yeni bir image oluşturuyorum v0.0.01 tagi ile. Daha sonra göreceğiniz docker CACHED olmuş verileri kullanarak diğer imageyi sadece 1.2 saniyede oluşturuyor.</li></ul><figure name="f1c6" id="f1c6" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*gYePpZSjGUiz_AhrNvCa3Q.png" data-width="480" data-height="493" src="https://cdn-images-1.medium.com/max/800/1*gYePpZSjGUiz_AhrNvCa3Q.png"></figure><h3 name="8137" id="8137" class="graf graf--h3 graf-after--figure">Port Binding (-p)</h3><h4 name="4243" id="4243" class="graf graf--h4 graf-after--h3">docker run -p ourOSPort:dockerPort imageId/imageName:tag</h4><ul class="postList"><li name="5c99" id="5c99" class="graf graf--li graf-after--h4">-p ile çalıştırdığımız containerın portunu kendi makinamızdaki port ile binding yani bağlama işlemlerini yapabiliriz.</li></ul><h4 name="9686" id="9686" class="graf graf--h4 graf-after--li">docker run -p 8000:80 imageId/imageName:tag</h4><ul class="postList"><li name="caa3" id="caa3" class="graf graf--li graf-after--h4">Yukarıda -p ile containerımızın çalıştığı hosttaki 80 portunu alıyoruz ve bunu bizim OS deki 8000 portuna bağlıyoruz. Burada ki 80 aynı zamanda bizim Dockerfile daki EXPOSE portumuzdur.</li></ul><h3 name="0107" id="0107" class="graf graf--h3 graf-after--li">Attach (-a) ve Detach(-d) Mods</h3><ul class="postList"><li name="5c76" id="5c76" class="graf graf--li graf-after--h3">Attach mod, imagemizi docker run ile container oluşturup çalıştırdığımızda terminalin çalıştırdığımız imagenin terminalinde durduğu moddur. docker run komutu default olarak attached modda çalışır.</li></ul><h4 name="d0da" id="d0da" class="graf graf--h4 graf-after--li">docker run -p 8000:80 -d imageId</h4><ul class="postList"><li name="4ff7" id="4ff7" class="graf graf--li graf-after--h4">d ile docker run yaparsak containerımızı detach modda başlatırız ve bu şekilde aşağıdaki resimdeki gibi imagenin terminaline düşmeyiz ve halen kendi terminalimizde oluruz.</li><li name="7bb7" id="7bb7" class="graf graf--li graf-after--li">Default olarak -d eklemeden bir container çalıştırırsak containerımız, attached mod olarak çalışır.</li></ul><h4 name="18b9" id="18b9" class="graf graf--h4 graf-after--li">docker attach containerId</h4><ul class="postList"><li name="10c3" id="10c3" class="graf graf--li graf-after--h4">Eger -d ile detach modda başlatsanız bile daha sornadan <strong class="markup--strong markup--li-strong">docker</strong> <strong class="markup--strong markup--li-strong">attach containerId</strong> ile çalışan containerınızı restart atmadan attach moda geçerek imagenizin terminaline bağlanabilirsiniz.</li></ul><h4 name="c957" id="c957" class="graf graf--h4 graf-after--li">docker logs containerId</h4><ul class="postList"><li name="975f" id="975f" class="graf graf--li graf-after--h4">Belirtilen çalışan containerin terminalinin o ana kadar ki loglarını basar.</li></ul><h4 name="d5b9" id="d5b9" class="graf graf--h4 graf-after--li">docker logs -f containerId</h4><ul class="postList"><li name="5bc0" id="5bc0" class="graf graf--li graf-after--h4">-f ekleyerek loğları terminal izler gibi canlı izleyebiliriz. -f follow anlamındadır.</li></ul><h4 name="2ca0" id="2ca0" class="graf graf--h4 graf-after--li">docker exec</h4><ul class="postList"><li name="381c" id="381c" class="graf graf--li graf-after--h4">Çalışan docker containerında komut çalıştırmamızı sağlar. Mesela aşağıda c1 diye identifier ettiğimiz yani isimlendirdiğimiz containerda ls komutunu çalıştırarak imagenin WORKDIR indeki yani app/ klasöründe ki dosyaları görüyoruz.</li></ul><figure name="eacf" id="eacf" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*3Y5HOyw-vbyaxp2KxAtTCQ.png" data-width="480" data-height="250" src="https://cdn-images-1.medium.com/max/800/1*3Y5HOyw-vbyaxp2KxAtTCQ.png"></figure><ul class="postList"><li name="2f0a" id="2f0a" class="graf graf--li graf-after--figure">Veya istersek aşağıda ki gibi -it ile interactive olarak canlı olarak, çalışan containerın terminaline bağlanıp kod yazabiliriz ve daha sonrada exit ile terminalden çıkabiliriz.</li></ul><figure name="6fea" id="6fea" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*ZhJPDKg2fV6mbIMtj9xSvw.png" data-width="480" data-height="121" src="https://cdn-images-1.medium.com/max/800/1*ZhJPDKg2fV6mbIMtj9xSvw.png"></figure><p name="8cc8" id="8cc8" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">docker run vs docker exec</strong></p><ul class="postList"><li name="1040" id="1040" class="graf graf--li graf-after--p">Run containerı başlatırken, exec çalışan bir containera baglanır.</li></ul><p name="85cf" id="85cf" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">docker run vs docker start</strong></p><ul class="postList"><li name="5267" id="5267" class="graf graf--li graf-after--p">docker run yeni bir container oluşturarak containerı çalıştırır. Docker start ise sadece daha önce stop edilmiş bir containerı çalıştırır.</li></ul><h3 name="c91d" id="c91d" class="graf graf--h3 graf-after--li">COPYING FILES BETWEEN HOST AND CONTAINER</h3><ul class="postList"><li name="2ad5" id="2ad5" class="graf graf--li graf-after--h3">Aşağıda önce containerlarimızı listeliyoruz.</li><li name="75fd" id="75fd" class="graf graf--li graf-after--li">Daha sonra çalışan birine interactive oluyoruz ve log.txt adında bir dosya oluşturuyoruz ve exit yaparak container terminalinden çıkıyoruz.</li></ul><figure name="dcfe" id="dcfe" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*uuNDIO1Ax0edygmr6MBtaQ.png" data-width="480" data-height="164" src="https://cdn-images-1.medium.com/max/800/1*uuNDIO1Ax0edygmr6MBtaQ.png"></figure><h4 name="a314" id="a314" class="graf graf--h4 graf-after--figure">docker cp containerId:/path/fileName.txt ourPath</h4><ul class="postList"><li name="7ad1" id="7ad1" class="graf graf--li graf-after--h4">Daha sonra ana makinamızda yani işletim sistemimizdeki terminalde, docker cp yaparak container idmizi verdikten sonra : yaparak pathimizi dosya adıyla birlikte yazıyoruz ve o dosyayı bulup “.” ile bulunduğumuz dizine kopyalamasını söylüyoruz. Gördüğünüz gibi daha sonra ls ile container içinde tanımlanan dosyayı listeleyebiliyoruz.</li></ul><figure name="b695" id="b695" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*a-WteNcvctQB5r4Ryxk6dg.png" data-width="480" data-height="122" src="https://cdn-images-1.medium.com/max/800/1*a-WteNcvctQB5r4Ryxk6dg.png"></figure><ul class="postList"><li name="6e73" id="6e73" class="graf graf--li graf-after--figure">Veya istersek ana makinamızda secret.txt adında bir dosya oluştururuz</li></ul><figure name="05e7" id="05e7" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*bMuV7qncTkSe-IEHj2tTtQ.png" data-width="480" data-height="40" src="https://cdn-images-1.medium.com/max/800/1*bMuV7qncTkSe-IEHj2tTtQ.png"></figure><ul class="postList"><li name="bd7f" id="bd7f" class="graf graf--li graf-after--figure">ve bunu çalışan containera aşağıda ki gibi atabiliriz.</li></ul><h4 name="461a" id="461a" class="graf graf--h4 graf-after--li"><strong class="markup--strong markup--h4-strong">docker cp filename containerId:/path</strong></h4><ul class="postList"><li name="18a4" id="18a4" class="graf graf--li graf-after--h4">Ve cp yaparak kopyalanacak dosyayı seçeriz daha sonra container id ve pathi aşağıda ki örnekte resimdeki gibi yazarız.</li><li name="d5c0" id="d5c0" class="graf graf--li graf-after--li">Daha sorna listelediğimizde gördüğünüz gibi dosyamızın oraya kopyalandığını görebiliriz.</li></ul><figure name="6f20" id="6f20" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*bMqVOWuSesFbU-0JRHdimA.png" data-width="480" data-height="370" src="https://cdn-images-1.medium.com/max/800/1*bMqVOWuSesFbU-0JRHdimA.png"></figure><h3 name="59a6" id="59a6" class="graf graf--h3 graf-after--figure">IMPORTING and EXPORTING IMAGES</h3><ul class="postList"><li name="3943" id="3943" class="graf graf--li graf-after--h3">Bazen imagelerimizi ana makinamıza export etmek yani indirmek veya ana makinamızda indirilmiş imageleri dockera import etmek yani yüklemek isteyebiliriz.</li></ul><h4 name="f6d5" id="f6d5" class="graf graf--h4 graf-after--li">SAVE<br>docker image save -o outputFileName imageId/imageName:tag</h4><ul class="postList"><li name="5af0" id="5af0" class="graf graf--li graf-after--h4">-o ile output alacağımız çıktı dosya ismini belirliyoruz ve daha sonra hangi taglı image olduğunu söylüyoruz.</li></ul><figure name="c98e" id="c98e" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*6Sp8tvmQT2B3tgpSbVkpDw.png" data-width="480" data-height="43" src="https://cdn-images-1.medium.com/max/800/1*6Sp8tvmQT2B3tgpSbVkpDw.png"></figure><ul class="postList"><li name="2201" id="2201" class="graf graf--li graf-after--figure">Ve aldığımız output zipli dosyasının içi aşağıda ki gibi linux sisteminde bir docker image dosyası elde ediyoruz.</li></ul><figure name="7ed9" id="7ed9" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*oYdmRUcmtKp4oFMMJRP6vA.png" data-width="480" data-height="213" src="https://cdn-images-1.medium.com/max/800/1*oYdmRUcmtKp4oFMMJRP6vA.png"></figure><h4 name="9cfd" id="9cfd" class="graf graf--h4 graf-after--figure">LOAD<br>docker image load -i react-app.tar</h4><ul class="postList"><li name="96c2" id="96c2" class="graf graf--li graf-after--h4">Load ornegini gosterecegimiz icin ilk localdeki imagemizi asagidaki gibi siliyoruz.</li></ul><figure name="5f67" id="5f67" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*JJbAJ1lbQc7uJXyUtGxHIA.png" data-width="480" data-height="60" src="https://cdn-images-1.medium.com/max/800/1*JJbAJ1lbQc7uJXyUtGxHIA.png"></figure><ul class="postList"><li name="4b30" id="4b30" class="graf graf--li graf-after--figure">Sonra imagemizi load ile aşağıda ki gibi yüklüyoruz.</li><li name="a87f" id="a87f" class="graf graf--li graf-after--li">-i import demektir.</li></ul><figure name="71a4" id="71a4" class="graf graf--figure graf-after--li graf--trailing"><img class="graf-image" data-image-id="1*4xWzCn__U1Zo4YQ8uLPfjA.png" data-width="480" data-height="86" src="https://cdn-images-1.medium.com/max/800/1*4xWzCn__U1Zo4YQ8uLPfjA.png"></figure></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@mucahidyazar" class="p-author h-card">Mucahid Yazar</a> on <a href="https://medium.com/p/6b3f19013bcf"><time class="dt-published" datetime="2021-05-28T07:03:56.995Z">May 28, 2021</time></a>.</p><p><a href="https://medium.com/@mucahidyazar/docker-the-core-part-image-container-6b3f19013bcf" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 24, 2022.</p></footer></article></body></html>