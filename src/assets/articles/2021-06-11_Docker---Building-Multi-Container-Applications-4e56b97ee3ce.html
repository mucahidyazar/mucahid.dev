<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Docker - Building Multi Container Applications</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Docker - Building Multi Container Applications</h1>
</header>
<section data-field="subtitle" class="p-summary">
Bu yazımda diğer 2 docker serisinden öğrendiklerimizi kullanarak, backend, frontend ve database containlerları oluşturup, 3 containerı…
</section>
<section data-field="body" class="e-content">
<section name="065b" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="e5f0" id="e5f0" class="graf graf--h3 graf--leading graf--title">Docker - Building Multi Container Applications</h3><p name="581e" id="581e" class="graf graf--p graf-after--h3">Bu yazımda diğer 2 docker serisinden öğrendiklerimizi kullanarak, backend, frontend ve database containlerları oluşturup, 3 containerı birbirleriyle iletişime geçirip uygulamamızı kurmayı, ayağa kaldırmayı öğreneceğiz ve öğrendiklerimiz içinde güzel bir pratik olacak bu.</p><figure name="6b46" id="6b46" class="graf graf--figure graf-after--p graf--trailing"><img class="graf-image" data-image-id="0*M3IzARZRrGSXtXpz.png" data-width="1000" data-height="500" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/0*M3IzARZRrGSXtXpz.png"></figure></div></div></section><section name="f764" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="505f" id="505f" class="graf graf--h3 graf--leading">STEP 1 - Get started</h3><p name="68f6" id="68f6" class="graf graf--p graf-after--h3"><a href="https://github.com/mucahidyazar/docker" data-href="https://github.com/mucahidyazar/docker" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">https://github.com/mucahidyazar/docker</a></p><ul class="postList"><li name="0819" id="0819" class="graf graf--li graf-after--p">Yukarıdaki linkten gerekli repoyu indiriyoruz.<br>git clone <a href="https://github.com/mucahidyazar/docker.git" data-href="https://github.com/mucahidyazar/docker.git" class="markup--anchor markup--li-anchor" rel="nofollow noopener" target="_blank">https://github.com/mucahidyazar/docker.git</a></li><li name="1603" id="1603" class="graf graf--li graf-after--li">Ve tutorials branchine geçiyoruz.<br>git checkout tutorials</li><li name="3884" id="3884" class="graf graf--li graf-after--li">Be burada multi-container adlı dizine geliyoruz. Burada 2 klasör var. 1. si başlangıç yani starter klasörü, diğeri bitiş yani fnished dosyalarımız.</li><li name="4f91" id="4f91" class="graf graf--li graf-after--li graf--trailing">Takıldığınız yerde fnished klasörüne bakıp kopya çekebilirsiniz.</li></ul></div></div></section><section name="8e98" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="fff5" id="fff5" class="graf graf--h3 graf--leading">STEP 2 - .dockerignore</h3><ul class="postList"><li name="0e0c" id="0e0c" class="graf graf--li graf-after--h3">İlk önce backend ve frontend klasörlerimize .dockerignore klasörü oluşturalım. Ve aşağıdaki gibi dockerın dokunmaması gereken dosya ve klasörleri belirleyelim. Ben standart olarak aşağıdaki şekilde oluşturuyorum.</li></ul><figure name="f415" id="f415" class="graf graf--figure graf--iframe graf-after--li graf--trailing"><script src="https://gist.github.com/mucahidyazar/6cbf60f84d06a0fea132677312a4a4ba.js"></script></figure></div></div></section><section name="e543" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="7d0f" id="7d0f" class="graf graf--h3 graf--leading">STEP 3 - Network</h3><ul class="postList"><li name="d4a5" id="d4a5" class="graf graf--li graf-after--h3">İlk önce containerlarımızın birbirleriyle iletişime geçecekleri networku oluşturalım. Ben multi adında bir network oluşturuyorum.<br><strong class="markup--strong markup--li-strong">docker volume create multi</strong></li><li name="b6dc" id="b6dc" class="graf graf--li graf-after--li graf--trailing">Daha sonra listeleyip volumemizin oluşturulduğundan emin olalım.<br><strong class="markup--strong markup--li-strong">docker volume ls</strong></li></ul></div></div></section><section name="09f6" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="d192" id="d192" class="graf graf--h3 graf--leading">STEP 3 - Dockerfile (for mongodb)</h3><ul class="postList"><li name="d2a3" id="d2a3" class="graf graf--li graf-after--h3">Şimdi ilk container olarak mongo imagesinde bir mongodb çalışan container ayağa kaldıracağız.</li></ul><blockquote name="62f9" id="62f9" class="graf graf--blockquote graf-after--li"><strong class="markup--strong markup--blockquote-strong">docker run \ <br>-v data:/data/db \ <br>-e MONGO_INITDB_ROOT_USERNAME=root \ <br>-e MONGO_INITDB_ROOT_PASSWORD=secret \<br>--name multi-mongo-container \ <br>--network multi \<br>--rm \ <br>-d \ <br>mongo</strong></blockquote><p name="b9b9" id="b9b9" class="graf graf--p graf-after--blockquote">Yukarıda ilk olarak data adında bir volume oluşturuyoruz ve mongo containerındaki /data/db yolunu bu data volumesine stroage olmasını yedeklemesini istiyoruz.<br>--name multi-mongo-container adıyla adlandırmak istediğimi belirtiyorum bu containerın.<br>-d ile detach modda çalıştırıyorum yani çalıştırdıktan sonra mongo terminalde kalmasın istiyorum.<br>--rm ile containerın stop olduğunda otomatik olarak silinmesini istiyoruz.<br>--network ile yukarıda oluşturduğumuz multi networkune mongo imagemizi başlatacağımız containerı bağlamak istiyoruz.<br>-e ile mongo database için belirlememiz gereken 2 tane environment variable’ı belirliyoruz. Bu environmentdaki varaiblesları daha sonra backend projemizde app.js içinde mongo databaseye bağlanmak için kullanacağız.<br>ve son olarak mongo imagesini çalıştırmasını söylüyoruz. Bu makinamızda yoksa dockerhub üzerinden indirir ve bu komutlarla çalıştırır.</p><ul class="postList"><li name="1184" id="1184" class="graf graf--li graf-after--p graf--trailing">Ve şimdi yine aşağıdaki kodla çalışan containerlarımızı görerek imageyi başarıyla çalıştırdığımızdan emin olalım.<br><strong class="markup--strong markup--li-strong">docker ps -a</strong></li></ul></div></div></section><section name="e292" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="724f" id="724f" class="graf graf--h3 graf--leading">STEP 4 - Dockerfile (for backend)</h3><ul class="postList"><li name="b340" id="b340" class="graf graf--li graf-after--h3">Ben aşağıda ki gibi Dockerfilemi oluşturuyorum. Daha önceki derslerde buradaki kavramları anlattığım için burayı detaylı olarak sizlere anlatmayacağım.</li></ul><figure name="34f4" id="34f4" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/mucahidyazar/e7bb4c4c66df92f94ce27538ff9b3a11.js"></script></figure><ul class="postList"><li name="bb4e" id="bb4e" class="graf graf--li graf-after--figure">Fakat yukarıda görüyoruz ki node app.js yaparak uygulamamızı başlatıyoruz. Bu uygulamamızda bir değişiklik olduğunda server taraflı değişikliklerde yeniden çalıştırılmayacağı için değişiklikleri yakalayabilmek için yeniden containerımızı başlatmak zorunda kalırız. Bu yüzden burada nodemon adlı package ile değişiklik olduğunda backend servisimizin kendisini otomatik olarak yenilemesini sağlayan paketi yükleyeceğim.</li><li name="af2f" id="af2f" class="graf graf--li graf-after--li">Önce backend dizinine geliyoruz terminalde ve aşağıda ki kodla packagemizi yükleyeceğiz.<br>yarn add -D nodemon<br>npm install --save-dev nodemon</li><li name="33e2" id="33e2" class="graf graf--li graf-after--li">Daha sonra package.jsonu aşağıdaki şekilde düzenliyorum.</li></ul><figure name="cfb2" id="cfb2" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/mucahidyazar/05145d448cbe363fe9fda884dc2d9805.js"></script></figure><ul class="postList"><li name="5d44" id="5d44" class="graf graf--li graf-after--figure">Ve Dockerfilemizdede CMD komutunu aşağıdaki şekildeki gibi düzeltiyoruz.</li></ul><figure name="feb1" id="feb1" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/mucahidyazar/eb3d0355278ec6352f611a7411115acf.js"></script></figure><ul class="postList"><li name="ffe4" id="ffe4" class="graf graf--li graf-after--figure">Ve şimdi de mongo imagesinde tanımladığımız environment variablesları backend içinde, config klasörü ve içindede env klasörü oluşturduktan sonra dev.env dosyası açarak içine aşağıdaki varaiblesları tanımlayalım.</li><li name="228c" id="228c" class="graf graf--li graf-after--li">Burada DB_NAME ve DB_PASSWORD mongo conta’nerımızda tanımladığımı environment variableslar olmalı yoksa erişimi sağlayamayız. Daha sonra bağlanacağımız databasenin host adresini DB_HOST, port adresini DB_PORT, ve adınıda DB_NAME olarak tanımlıyoruz.</li></ul><figure name="079a" id="079a" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/mucahidyazar/a5ed1388c648e4c02b4373a513dda79f.js"></script></figure><ul class="postList"><li name="d325" id="d325" class="graf graf--li graf-after--figure">Tabi bu variablesları kullanabilmek için node.js projemizde dotenv gibi ekstra paketleri yüklememiz ve kullanmamız gerekecek. Ben dotenv yi yükleyeceğim.<br>yarn add dotenv<br>npm install dotenv</li><li name="6578" id="6578" class="graf graf--li graf-after--li">Ve app.js içine gelerek yüklediğimiz bu dotenv modülünü require ile aşağıdaki gibi projenin en başına ekleyerek, içine dev.env dosyamızın yolunu yani pathini veriyoruz.</li></ul><figure name="cd25" id="cd25" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/mucahidyazar/db30c75d4b4a72ebec7d036cb44980cc.js"></script></figure><ul class="postList"><li name="fcde" id="fcde" class="graf graf--li graf-after--figure">Ve daha sonra yine app.js içinde mongo databasesine bağlandığımız kod dizininde bu dev.environment variablesları buraya veriyoruz. Ve bu varaibleslar mongoda tanımladığımız varaibleslarla eşleşince başarıyla bağlantı sağlayabileceğiz.</li><li name="12e1" id="12e1" class="graf graf--li graf-after--li">Ve ikinci olarak da mongo container adımızı database bağlantı hostu için ayarladığımı DB_HOST environment variablesını ve portunu DB_PORT’u aralarında “:” işareti olacak şekilde yazıyoruz. Çünkü backendide aynı networke bağladığımızda container adıyla mongoya erişebiliyor olacağız.</li><li name="01c0" id="01c0" class="graf graf--li graf-after--li">Sonrada bağlanacağımız database ismini atadığımız environment variable’ı yazıyoruz.</li><li name="d0e2" id="d0e2" class="graf graf--li graf-after--li">Ve en son olarakda “?authSource=admin” diyererek ayarlamamızı yapıyoruz. Burası user credentialsala birlikte collection’a sahip databasenin adıdır. Kısaca username ve passwordların ayarlandığı yerdir.</li></ul><figure name="c2a6" id="c2a6" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/mucahidyazar/a3584506e074943d4107967e1722cd96.js"></script></figure><ul class="postList"><li name="d70c" id="d70c" class="graf graf--li graf-after--figure">Ve şimdi tüm ayarlamalarımızı yaptıktan sonra imagemizi oluşturabilir ve containerımızı çalıştırabiliriz.</li><li name="ab6d" id="ab6d" class="graf graf--li graf-after--li">İlk önce şağıdaki kodla imagemizi oluşturuyoruz.<br>docker build -t multi-backend-image .</li></ul><p name="fa94" id="fa94" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">docker run <br>-p 80:80 \<br>-v ${pwd}:/app \<br>-v logs:/app/logs \<br>-v /app/node_modules \<br>--env-file ./config/env/dev.env \<br>--name multi-backend-container \<br>--network multi \<br>--rm \<br>multi-backend-image</strong></p><ul class="postList"><li name="9ec8" id="9ec8" class="graf graf--li graf-after--p graf--trailing">Ve şimdide yukarıdaki kodla containerımızı çalıştırıyoruz.<br><strong class="markup--strong markup--li-strong">--rm</strong> ile containerımızın stop olunca silinmesini söylüyoruz<br> <strong class="markup--strong markup--li-strong">--network </strong>ile containerımızı multi isimli networke dahil ediyoruz<br><strong class="markup--strong markup--li-strong">-p</strong> ile port binding yaparak containerımızı kendi <strong class="markup--strong markup--li-strong">OS sistemimizdeki 80 ile</strong> çalıştığı <strong class="markup--strong markup--li-strong">VM(Virtual Machine)’deki 80</strong> portlarını bind etmesini bağlamasını söylüyoruz. Böylece containerın çalıştığı VM’deki 80 portu bizim makinamızdaki 80 portuna yansıyacak. Ve böylelikle localhost adresinden direkt olarak container’a erişim sağlayabileceğiz.<br><strong class="markup--strong markup--li-strong">--name</strong> ile containerımızı identifier ettiğimiz bir isimlendirme uyguluyoruz yani containerımızı isimlendiriyoruz. Burada backend için multi-backend-container koydum ben düzenli olması için.<br><strong class="markup--strong markup--li-strong">-v ${pwd}:/app volume</strong> belirlemesi ile şuan ki dizinde yani kodu yazdığımız dizindeki, yani backend klasörünün içindeki tüm herşeyi Dockerdaki /app klasörüne yani WORKDIR’e bağlamasını istiyoruz. Böylelikle localde yaptığımız değişiklikler anında, containerımızın çalıştığı VM’ye yansıyabilecek.<br><strong class="markup--strong markup--li-strong">-v logs:/app/logs</strong> volume tanımlaması ilede, logs adında bir volume oluşturmasını söylüyoruz Docker’a, ve bu logs volumesine, conteinerımızın logladığı VM’de çalışma dizindeki logların tutulduğu pathdeki(/app/logs) logları saklamasını söylüyoruz.<br><strong class="markup--strong markup--li-strong">-v /app/node_modules</strong> ile containerımızın npm install yaptıktan sonra buradaki node_modules dosyalarını anonymous volume oluşturarak saklamasını istiyoruz.<br><strong class="markup--strong markup--li-strong">--env-file</strong> ilede backend projemizin çalıştığı zaman ihtiyacı olacak environment varaiblesları içeren env dosyasının yolunu vererek, environment variableslarını dockera tanımlamasını söylüyoruz.<br>Ve son olarak image adını yazıyoruz.</li></ul></div></div></section><section name="ab1d" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="ddf5" id="ddf5" class="graf graf--h3 graf--leading">STEP 5 - Dockerfile (for frontend)</h3><p name="7f4b" id="7f4b" class="graf graf--p graf-after--h3">Backend ve mongo-containerımızı ayağa kaldırdığımıza göre şimdi sıra frontend uygulamamızı Dockerize etmeye geldi.</p><ul class="postList"><li name="ca19" id="ca19" class="graf graf--li graf-after--p">Dockerfile’mi oluşturup içini aşağıda ki gibi ayarladım.</li></ul><figure name="f96f" id="f96f" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/mucahidyazar/0b9639c70e5300cd7fb8ab526477d964.js"></script></figure><ul class="postList"><li name="6f33" id="6f33" class="graf graf--li graf-after--figure">Daha sonra imagemizi build alıyoruz aşağıda ki kodla.<br><strong class="markup--strong markup--li-strong">docker build -t multi-frontend-image .</strong></li></ul><p name="ca50" id="ca50" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">docker run -v ${pwd}/src:/app/src --rm -it --name multi-frontend-container -p 3000:3000 multi-frontend-image</strong></p><ul class="postList"><li name="a059" id="a059" class="graf graf--li graf-after--p graf--trailing">Ve son olarak da aşağıda ki kodu kullanarak oluşturduğumuz uygulamamızın imagesini containerımızı çalıştırarak kullanıyoruz.<br><strong class="markup--strong markup--li-strong">-v ${pwd}/src:/app/src</strong> ile uygulamamızın kendi OS sistemimiz üzerindeki src yolunu, pathini, containerımızın sistemi üzerindeki /app/src dizini ile bind ediyoruz bağlıyoruz. Böylelikle react uygulamamız localde yaptığımız değişiklikleri anında containera yansıtacaktır.<br><strong class="markup--strong markup--li-strong">--rm</strong> ile containerımızın stop olunca silinmesini söylüyoruz<br> <strong class="markup--strong markup--li-strong">--network </strong>ile containerımızı multi isimli networke dahil ediyoruz<br><strong class="markup--strong markup--li-strong">-it</strong> ile interactive mod ile containerımızı başlatacağız ve böylelikle react uygulaması çalışırken teminali izleyip başarıyla başlayıp başlamadığını görebileceğiz.<br><strong class="markup--strong markup--li-strong"> --name</strong> ile containerımızı identifier ettiğimiz bir isimlendirme uyguluyoruz yani containerımızı isimlendiriyoruz. Burada frontend için multi-frontend-container koydum ben düzenli olması için.<br><strong class="markup--strong markup--li-strong">-p</strong> ile port binding yaparak containerımızı kendi <strong class="markup--strong markup--li-strong">OS sistemimizdeki 3000 ile</strong> çalıştığı <strong class="markup--strong markup--li-strong">VM(Virtual Machine)’deki 3000</strong> portlarını bind etmesini bağlamasını söylüyoruz. Böylece containerın çalıştığı VM’deki 3000 portu bizim makinamızdaki 3000 portuna yansıyacak. Ve böylelikle localhost adresinden direkt olarak container’a erişim sağlayabileceğiz.<br>Ve son olarak image adını yazıyoruz.</li></ul></div></div></section><section name="17ee" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><ul class="postList"><li name="2fad" id="2fad" class="graf graf--li graf--leading">Ve evet tüm adımları tamamlayıp uygulamalarımızı başarıyla Dockerize ettik. Final görüntüsü aşağıda ki gibi.</li></ul><figure name="f27b" id="f27b" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*nfHCiqB_NdyZLD8XttzdZQ.png" data-width="480" data-height="204" src="https://cdn-images-1.medium.com/max/800/1*nfHCiqB_NdyZLD8XttzdZQ.png"></figure><ul class="postList"><li name="86a3" id="86a3" class="graf graf--li graf-after--figure graf--trailing">Peki biz bu yazımız da neler yaptık?<br>3 container çalıştırdık.<br>Network kurup containerlarımız arası iletişim kanalı iletişim kanalı oluşturup, bu kanal üzerinden haberleştik.<br>2 tane Dockerfile oluşturduk.<br>3 containerımıza özel farklı volumeler oluşturduk.<br>Bir önceki yazılardan öğrendiklerimizi fazlasıyla tekrar ettik.</li></ul></div></div></section><section name="9058" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="6618" id="6618" class="graf graf--p graf--leading graf--trailing">Bu yazımda anlatacaklarım bu kadardı. Bir sonra ki örnekte bunu docker-compose kullanarak nasıl çok daha az terminal kodu yazarak yapacağız bunu göreceğiz. Esen kalın.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@mucahidyazar" class="p-author h-card">Mucahid Yazar</a> on <a href="https://medium.com/p/4e56b97ee3ce"><time class="dt-published" datetime="2021-06-11T07:02:43.669Z">June 11, 2021</time></a>.</p><p><a href="https://medium.com/@mucahidyazar/docker-building-multi-container-applications-4e56b97ee3ce" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 24, 2022.</p></footer></article></body></html>